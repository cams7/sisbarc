<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>DataTable - Lazy</title>
</h:head>
<h:body>
	<f:view contentType="text/html">
		<h:form id="form">
			<p:messages id="messages" showDetail="true" autoUpdate="true"
				closable="true" />


			<p:dataTable var="car" value="#{dtLazyView.lazyModel}"
				paginator="true" rows="#{dtLazyView.rows}"
				first="#{dtLazyView.first}"
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
				rowsPerPageTemplate="5,10,15" selectionMode="single"
				selection="#{dtLazyView.selectedCar}" id="carTable" lazy="true"
				widgetVar="carsTable"
				emptyMessage="No cars found with given criteria">

				<p:ajax event="rowSelect" listener="#{dtLazyView.onRowSelect}"
					update=":form:carDetail" onstart="dlg.show();"
					oncomplete="dlg.hide();" onsuccess="carDialog.show();" />

				<p:column headerText="Id" sortBy="#{car.id}" filterBy="#{car.id}">
					<h:outputText value="#{car.id}" />
				</p:column>


				<p:column headerText="Year" sortBy="#{car.year}"
					filterBy="#{car.year}">
					<h:outputText value="#{car.year}" />
				</p:column>

				<p:column headerText="Brand" sortBy="#{car.brand.name}"
					filterBy="#{car.brand.name}">
					<h:outputText value="#{car.brand.name}" />
				</p:column>


				<p:column headerText="Color" sortBy="#{car.color}"
					filterBy="#{car.color}">
					<h:outputText value="#{car.color}" />
				</p:column>

				<p:column headerText="City" sortBy="#{car.brand.city.name}"
					filterBy="#{car.brand.city.name}">
					<h:outputText value="#{car.brand.city.name}" />
				</p:column>

				<p:column headerText="State" sortBy="#{car.brand.city.state.name}"
					filterBy="#{car.brand.city.state.name}">
					<h:outputText value="#{car.brand.city.state.name}" />
				</p:column>

				<p:column headerText="Country"
					sortBy="#{car.brand.city.state.country.name}"
					filterBy="#{car.brand.city.state.country.name}">
					<h:outputText value="#{car.brand.city.state.country.name}" />
				</p:column>

				<p:column headerText="Sale date" sortBy="#{car.saleDate}"
					filterBy="#{car.saleDate}">
					<h:outputText value="#{car.saleDate}">
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
					</h:outputText>
				</p:column>
			</p:dataTable>

			<p:dialog id="dialog" header="Running" widgetVar="dlg" modal="true"
				visible="false">
				<h:outputText value="Wait..." />
			</p:dialog>

			<p:dialog header="Car Detail" widgetVar="carDialog" modal="true"
				showEffect="fade" hideEffect="fade" resizable="false">
				<p:outputPanel id="carDetail" style="text-align:center;">
					<p:panelGrid columns="2"
						rendered="#{not empty dtLazyView.selectedCar}"
						columnClasses="label,value">
						<f:facet name="header">
							<p:graphicImage
								name="demo/images/car/#{dtLazyView.selectedCar.brand.name}-big.gif" />
						</f:facet>

						<h:outputText value="Id:" />
						<h:outputText value="#{dtLazyView.selectedCar.id}" />

						<h:outputText value="Year" />
						<h:outputText value="#{dtLazyView.selectedCar.year}" />

						<h:outputText value="Color:" />
						<h:outputText value="#{dtLazyView.selectedCar.color}"
							style="color:#{dtLazyView.selectedCar.color}" />

						<h:outputText value="Price:" />
						<h:outputText value="#{dtLazyView.selectedCar.price}">
							<f:convertNumber type="currency" currencySymbol="$" />
						</h:outputText>
					</p:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>
	</f:view>
</h:body>
</html>